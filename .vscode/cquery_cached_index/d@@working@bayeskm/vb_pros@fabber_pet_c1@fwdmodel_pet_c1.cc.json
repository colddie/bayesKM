16
{"last_modification_time":1574109602,"language":2,"import_file":"d:/working/bayeskm/vb_pros/fabber_pet_c1/fwdmodel_pet_c1.cc","args_hash":3416621732313805335,"includes":[{"line":3,"resolved_path":"d:/working/bayeskm/vb_pros/fabber_pet_c1/fwdmodel_pet_c1.h"},{"line":14,"resolved_path":"d:/windows kits/10/include/10.0.17763.0/ucrt/math.h"}],"dependencies":["d:/working/bayeskm/vb_pros/fabber_pet_c1/fwdmodel_pet_c1.h"],"skipped_by_preprocessor":[],"types":[{"id":0,"usr":7240442049476892219,"detailed_name":"","short_name_offset":0,"short_name_size":0,"kind":0,"hover":"","comments":"","declarations":[],"bases":[],"derived":[],"types":[],"funcs":[0,1,2,3,4,5,6],"vars":[0,2,10],"instances":[],"uses":["23:51-23:62|-1|1|4","25:11-25:22|-1|1|4","30:8-30:19|-1|1|4","35:8-35:19|-1|1|4","83:6-83:17|-1|1|4","95:6-95:17|-1|1|4","142:5-142:16|-1|1|4","150:6-150:17|-1|1|4","191:6-191:17|-1|1|4","221:6-221:17|-1|1|4"]},{"id":1,"usr":17,"detailed_name":"","short_name_offset":0,"short_name_size":0,"kind":0,"hover":"","comments":"","declarations":[],"bases":[],"derived":[],"types":[],"funcs":[],"vars":[],"instances":[0,1,3,4,5,6,8,11,12,13,14,15,16,17],"uses":[]},{"id":2,"usr":2,"detailed_name":"","short_name_offset":0,"short_name_size":0,"kind":0,"hover":"","comments":"","declarations":[],"bases":[],"derived":[],"types":[],"funcs":[],"vars":[],"instances":[2,10],"uses":[]},{"id":3,"usr":22,"detailed_name":"","short_name_offset":0,"short_name_size":0,"kind":0,"hover":"","comments":"","declarations":[],"bases":[],"derived":[],"types":[],"funcs":[],"vars":[],"instances":[18],"uses":[]}],"funcs":[{"id":0,"usr":9526475735430005788,"detailed_name":"int *PetFwdModel::NewInstance()","short_name_offset":18,"short_name_size":11,"kind":6,"storage":1,"hover":"","comments":"","declarations":[],"spell":"25:24-25:35|0|2|2","extent":"25:1-28:2|-1|1|0","declaring_type":0,"bases":[],"derived":[],"vars":[],"uses":[],"callees":[]},{"id":1,"usr":12436270510839673979,"detailed_name":"int PetFwdModel::GetDescription() const","short_name_offset":17,"short_name_size":14,"kind":6,"storage":1,"hover":"","comments":"","declarations":[],"spell":"30:21-30:35|0|2|2","extent":"30:1-33:2|-1|1|0","declaring_type":0,"bases":[],"derived":[],"vars":[],"uses":[],"callees":[]},{"id":2,"usr":17691954583605420862,"detailed_name":"int PetFwdModel::ModelVersion() const","short_name_offset":17,"short_name_size":12,"kind":6,"storage":1,"hover":"","comments":"","declarations":[],"spell":"35:21-35:33|0|2|2","extent":"35:1-38:2|-1|1|0","declaring_type":0,"bases":[],"derived":[],"vars":[],"uses":[],"callees":[]},{"id":3,"usr":18378277709353345041,"detailed_name":"void PetFwdModel::Initialize(int &rundata)","short_name_offset":18,"short_name_size":10,"kind":6,"storage":1,"hover":"","comments":"Options specified by the user are captured in the FabberRunData object which we use to set the variables in our model\n class in the Initialize method. Initialize is called before the model will be used. Its purpose is to allow the model\n  to set up any internal variables based on the user-supplied options. Here we capture the time resolution option and\n   the number of exponentials - note that the latter has a default value:","declarations":[],"spell":"95:19-95:29|0|2|2","extent":"95:1-140:2|-1|1|0","declaring_type":0,"bases":[],"derived":[],"vars":[3,4,5,6,8],"uses":[],"callees":[]},{"id":4,"usr":6262794292996938471,"detailed_name":"int PetFwdModel::NumParams() const","short_name_offset":17,"short_name_size":9,"kind":6,"storage":1,"hover":"","comments":"","declarations":[],"spell":"142:18-142:27|0|2|2","extent":"142:1-148:2|-1|1|0","declaring_type":0,"bases":[],"derived":[],"vars":[],"uses":["193:22-193:31|5|3|36"],"callees":[]},{"id":5,"usr":17297731709608751364,"detailed_name":"void PetFwdModel::HardcodedInitialDists(int &prior, int &posterior) const","short_name_offset":18,"short_name_size":21,"kind":6,"storage":1,"hover":"","comments":"Priors are central to Bayesian inference, and describe the extent of our belief about a parameter’s value before we have seen any data.\nFor example if a parameter represents the T_1 value of grey matter in the brain there is a well known range of plausible values. \nBy declaring a suitable prior we ensure that probabilities are calculated correctly and unlikely values of the parameter are avoided \nunless the data very strongly supports this.\nIn our case we have no real prior information, so we are using an uninformative prior. This has a large variance so the model has a \nlot of freedom in fitting the parameters and will try to get as close to matching the data as it can. This is reflected in the high \nvariance we are using (1e6). For the mean values, a and b are multiplicative so it makes sense to give them defaults of 1 wherease c\n and d are additive so prior means of 0 seems more appropriate.\nThe second DistParams instance represents the initial posterior. This is the starting point for the optimisation as it tries to find\n the best values for each parameter. Usually this does not matter too much and can often be set to be identical to the prior.\nSometimes, however, it may be helpful to give the initial posterior a more restrictive (lower) variance to avoid numerical instability.\nIt is also possible to adjust the initial posterior on a per-voxel basis using the actual voxel data. We will not do that here, but it\n can be useful when fitting, for example, a constant offset, where we can tell the optimisation to start with a value that is the mean\n  of the data. This may help avoid instability and local minima.\nIn general it is against the spirit of the Bayesian approach to modify the priors on the basis of the data, and no means are provided to\n do this. It is possible for the user to modify the priors on a global basis but this is not encouraged and in general a model should try to provide good priors that will not need modification.","declarations":[],"spell":"191:19-191:40|0|2|2","extent":"191:1-214:2|-1|1|0","declaring_type":0,"bases":[],"derived":[],"vars":[11,12,13,14],"uses":[],"callees":["193:22-193:31|4|3|36","193:22-193:31|4|3|36"]},{"id":6,"usr":5275322567774856407,"detailed_name":"void PetFwdModel::Evaluate(const int &params, int &result) const","short_name_offset":18,"short_name_size":8,"kind":6,"storage":1,"hover":"","comments":"We now go back to our model code where we finally reach the point where we write the code to calculate our model:\nWe are given a list of parameter values (params) and need to produce a time series of predicted data values (result).\n We do this by looping over the parameters and adding the result of each exponential to the output result.\nThe additional argument key is not required in this case. It is used to allow a model to evaluate ‘alternative’ outputs \nsuch as an interim residual or AIF curve","declarations":[],"spell":"221:19-221:27|0|2|2","extent":"221:1-261:2|-1|1|0","declaring_type":0,"bases":[],"derived":[],"vars":[15,16,17,18],"uses":[],"callees":[]}],"vars":[{"id":0,"usr":15905035324973131287,"detailed_name":"int PetFwdModel::registration","short_name_offset":17,"short_name_size":12,"hover":"","comments":"We need to implement a couple of methods to ensure that our model is visible to the Fabber system:\nThe first line here registers our model so that it is known to Fabber by the name exp The second line \nis a Factory method used so that Fabber can create a new instance of our model when its name appears on the command line:","declarations":[],"spell":"23:64-23:76|0|2|2","extent":"23:1-23:76|-1|1|0","type":1,"uses":[],"kind":8,"storage":1},{"id":1,"usr":5634130264244906055,"detailed_name":"int [] OPTIONS","short_name_offset":7,"short_name_size":7,"hover":"","comments":"We’ve given our model a version number, if we update it at some later stage we should change the number returned \nso anybody using the model will know it has changed and what version they have. There’s also a brief description\n which fabber will return when the user requests help on the model:\nEach option is listed in the OPTIONS array which ends with an empty option (important!)\n\nAn option is described by:\nIt’s name which generally should not include underscores (hyphen is OK as in this case). The name translates into a \ncommand line option e.g. --num-exps.\nAn option type. Possibilities are:\nOPT_BOOL for a Yes/No boolean\nOPT_FLOAT for a decimal number\nOPT_INT for a whole number\nOPT_STR for text\nOPT_MATRIX for a small matrix (specified by giving the filename of a text file which contains the matrix data in\n tab-separated form)\nOPT_IMAGE for a 3D image specified as a Nifti file\nOPT_TIMESERIES for a 4D image specified as a Nifti file\nOPT_FILE for a generic filename\nA brief description of the option. This will be displayed when --help is requested for the model\nOPT_NONREQ if the option is not mandatory (does not need to be specified) or OPT_REQ if the option must be provided \nby the user.\nAn indication of the default value. This value is not actually used to initialize anything but is shown in --help to\n explain to the user what the default is if the option is not given. So it can contain any text (e.g. \"0.7 for PASL, \n 1.3 for pCASL\". You should not specify a default for a mandatory option (OPT_REQ)","declarations":[],"spell":"64:19-64:26|-1|1|2","type":1,"uses":[],"kind":13,"storage":3},{"id":2,"usr":18391506153156487987,"detailed_name":"void PetFwdModel::GetOptions","short_name_offset":18,"short_name_size":10,"hover":"","comments":"","declarations":[],"spell":"83:19-83:29|0|2|2","extent":"83:1-83:29|-1|1|0","type":2,"uses":[],"kind":8,"storage":1},{"id":3,"usr":13727938045720770327,"detailed_name":"int &rundata","short_name_offset":5,"short_name_size":7,"hover":"","comments":"","declarations":[],"spell":"95:45-95:52|3|3|2","extent":"95:30-95:52|3|3|0","type":1,"uses":[],"kind":253,"storage":1},{"id":4,"usr":5002311301908383530,"detailed_name":"int designFile","short_name_offset":4,"short_name_size":10,"hover":"","comments":"m_include_offset = rundata.GetBool(\"use-offset\");","declarations":[],"spell":"115:12-115:22|3|3|2","extent":"115:5-115:22|3|3|0","type":1,"uses":[],"kind":13,"storage":1},{"id":5,"usr":5430191999184919702,"detailed_name":"int *myFile","short_name_offset":5,"short_name_size":6,"hover":"","comments":"","declarations":[],"spell":"117:11-117:17|3|3|2","extent":"117:5-117:17|3|3|0","type":1,"uses":[],"kind":13,"storage":1},{"id":6,"usr":6877991310884281763,"detailed_name":"int i","short_name_offset":4,"short_name_size":1,"hover":"int i = 0","comments":"","declarations":[],"spell":"120:15-120:16|3|3|2","extent":"120:11-120:20|3|3|0","type":1,"uses":["120:22-120:23|3|3|12","120:35-120:36|3|3|28"],"kind":13,"storage":1},{"id":7,"usr":17020199652324899047,"detailed_name":"","short_name_offset":0,"short_name_size":0,"hover":"","comments":"","declarations":[],"uses":["120:26-120:33|3|3|12","131:26-131:33|3|3|12"],"kind":0,"storage":0},{"id":8,"usr":14026343912904987573,"detailed_name":"int i","short_name_offset":4,"short_name_size":1,"hover":"int i = 0","comments":"","declarations":[],"spell":"131:15-131:16|3|3|2","extent":"131:11-131:20|3|3|0","type":1,"uses":["131:22-131:23|3|3|12","131:35-131:36|3|3|28"],"kind":13,"storage":1},{"id":9,"usr":13315789105831506038,"detailed_name":"","short_name_offset":0,"short_name_size":0,"hover":"","comments":"","declarations":[],"uses":["144:9-144:25|4|3|12"],"kind":0,"storage":0},{"id":10,"usr":18275587181257979905,"detailed_name":"void PetFwdModel::NameParams","short_name_offset":18,"short_name_size":10,"hover":"","comments":"","declarations":[],"spell":"150:19-150:29|0|2|2","extent":"150:1-150:29|-1|1|0","type":2,"uses":[],"kind":8,"storage":1},{"id":11,"usr":10357824059881864644,"detailed_name":"int &prior","short_name_offset":5,"short_name_size":5,"hover":"","comments":"","declarations":[],"spell":"191:50-191:55|5|3|2","extent":"191:41-191:55|5|3|0","type":1,"uses":[],"kind":253,"storage":1},{"id":12,"usr":5990732898416699976,"detailed_name":"int &posterior","short_name_offset":5,"short_name_size":9,"hover":"","comments":"","declarations":[],"spell":"191:66-191:75|5|3|2","extent":"191:57-191:75|5|3|0","type":1,"uses":[],"kind":253,"storage":1},{"id":13,"usr":8599386230119207298,"detailed_name":"int num_params","short_name_offset":4,"short_name_size":10,"hover":"int num_params = NumParams()","comments":"","declarations":[],"spell":"193:9-193:19|5|3|2","extent":"193:5-193:33|5|3|0","type":1,"uses":[],"kind":13,"storage":1},{"id":14,"usr":16773133454474386883,"detailed_name":"int precisions","short_name_offset":4,"short_name_size":10,"hover":"","comments":"1e1;     //1e-2;","declarations":[],"spell":"209:21-209:31|5|3|2","extent":"209:5-209:31|5|3|0","type":1,"uses":[],"kind":13,"storage":1},{"id":15,"usr":407366521752660501,"detailed_name":"const int &params","short_name_offset":11,"short_name_size":6,"hover":"","comments":"","declarations":[],"spell":"221:48-221:54|6|3|2","extent":"221:28-221:54|6|3|0","type":1,"uses":[],"kind":253,"storage":1},{"id":16,"usr":12520027100210283571,"detailed_name":"int &result","short_name_offset":5,"short_name_size":6,"hover":"","comments":"","declarations":[],"spell":"221:70-221:76|6|3|2","extent":"221:56-221:76|6|3|0","type":1,"uses":[],"kind":253,"storage":1},{"id":17,"usr":4181588873495330492,"detailed_name":"int ret","short_name_offset":4,"short_name_size":3,"hover":"","comments":"","declarations":[],"spell":"224:9-224:12|6|3|2","extent":"224:5-224:12|6|3|0","type":1,"uses":[],"kind":13,"storage":1},{"id":18,"usr":18317931400252669132,"detailed_name":"double *results","short_name_offset":8,"short_name_size":7,"hover":"","comments":"","declarations":[],"spell":"225:13-225:20|6|3|2","extent":"225:5-225:20|6|3|0","type":3,"uses":[],"kind":13,"storage":1}]}